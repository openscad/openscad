name: Update Debian base image in Dockerfile

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "{{ .github.repository }}"
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      branch: "{{ .github.branch }}"

sources:
  debian-trixie:
    name: Get latest Debian Trixie slim image tag
    kind: dockerimage
    spec:
      image: debian
      tagfilter: 'trixie-\d{8}-slim'
      versionfilter:
        kind: regex
        pattern: 'trixie-(\d{8})-slim'

conditions:
  docker-image-exists:
    name: Verify Debian image exists on Docker Hub
    kind: dockerimage
    spec:
      image: debian
      tag: '{{ source "debian-trixie" }}'

targets:
  dockerfile:
    name: Update Dockerfile base image
    kind: file
    spec:
      file: Dockerfile
      matchpattern: 'FROM debian:trixie-\d{8}-slim'
      replacepattern: 'FROM debian:{{ source "debian-trixie" }}'
    scmid: default

actions:
  default:
    kind: github/pullrequest
    scmid: default
    spec:
      title: 'chore(deps): update Debian base image to {{ source "debian-trixie" }}'
      labels:
        - dependencies
        - docker
      description: |
        ## Automated Debian Base Image Update

        Updates the Docker base image to the latest Debian Trixie release.

        **Changes:**
        - Dockerfile: `FROM debian:{{ source "debian-trixie" }}`

        **Verification Checklist:**
        - [ ] Docker build completes for all architectures (amd64, arm64, riscv64)
        - [ ] OpenSCAD builds correctly inside container
        - [ ] Image size is reasonable

        ---
        ðŸ¤– Auto-generated by [UpdateCLI](https://www.updatecli.io/)
