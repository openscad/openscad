version: 2
jobs:
  openscad-macos:
    macos:
      xcode: "10.1.0"
    steps:
      - checkout
      - run:
          name: Build OpenSCAD MacOS
          no_output_timeout: 18000
          command: |
              system_profiler SPSoftwareDataType
              curl -s -O https://distfiles.macports.org/MacPorts/MacPorts-2.5.4.tar.bz2
              tar xjf MacPorts-2.5.4.tar.bz2
              cd MacPorts-2.5.4
              ./configure
              make
              sudo make install
              echo export\ PATH=/opt/local/bin:/opt/local/sbin:\$PATH >> ~/.profile
              source ~/.profile
              sudo port -v selfupdate
              export COLUMNS=80
              sudo port install cmake
              sudo port install curl
              sudo port install pkg-config
              mkdir /tmp/out
              tar cjvf /tmp/out/macports.tar.bz2 /opt/local
              #source setenv_mac.sh
              #./scripts/macosx-build-dependencies.sh double_conversion
      - store_artifacts:
          path: /tmp/out
          destination: build

workflows:
  version: 2
  build:
    jobs:
      - openscad-macos:
          filters:
              branches:
                  ignore:
                      - coverity_scan
                      - /^(?i:continuous)$/
